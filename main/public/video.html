<!DOCTYPE html>
<html>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<body>
  <nav>
  <a href="index.html">Test Page</a> |
  </nav>

  <div class="container">
    <div class= "title">
      <h1>Where Videos Rule</h1>

    </div>
  <div id="video-div">
  </div>


  <script id="video" type="text/x-handlebars-template">
    <h1>Video List {{name}}</h1>
    <div class="media">

      <div class="media-body">
        <dl class="dl-horizontal">
          <dt>Name</dt><dd class="clearfix">{{name}}</dd>
          <dt>Type</dt><dd>{{type}}</dd>
        </dl>
      </div>
    </div>

    <div id="player"></div>

    </div>

  </script>
  <div class= "Next">
    <button onclick="NextVideo()" type="button">Next Video</button>
  </div>




  <script>
        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        var database;
        var VidID;
        $.get('http://localhost:3000/db', {}, function(data){
          database = data;
         });

        function onYouTubeIframeAPIReady(VidID) {

          if (VidID === undefined){VidID = 0};
          player = new YT.Player('player', {
            height: '390',
            width: '640',
            videoId: database.data.videos[VidID].id,
            events: {
              'onReady': onPlayerReady,
            }
          });
        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
          event.target.playVideo();
        }

        function NextVideo(){
          if (VidID === undefined){VidID = 0};
          console.log("New ID! " + VidID);
          var vid = database.data.videos[VidID+1].id
          if (vid == undefined){console.log("No more vids yo");return}
          console.log("New ID! " + vid);
          player.loadVideoById({videoId:vid,
                      suggestedQuality:"large"})
        }


  </script>


  <script>
  //Script to pull in db data
    //debugger;
    (function() {
      var videoSource = document.getElementById('video').innerHTML,
          videoTemplate = Handlebars.compile(videoSource),
          videoPlaceholder = document.getElementById('video-div');

      $.get('http://localhost:3000/db', {}, function(data){
        console.log(data.data.videos[0]);
            videoPlaceholder.innerHTML = videoTemplate(data.data.videos[0])
       });

    })();
  </script>



</body>
</html>
